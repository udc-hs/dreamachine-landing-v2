<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dreamachine</title>
  <style>
    /* Ensure fullscreen layout */
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
    }

    /* Common styles for both videos */
    .video-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      pointer-events: none;
    }

    /* The top video has a circular reveal effect with feathered edges */
    .top-video {
      position: absolute;
      -webkit-mask-image: radial-gradient(circle, rgba(0,0,0,1) 50%, rgba(0,0,0,0) 100%);
      mask-image: radial-gradient(circle, rgba(0,0,0,1) 50%, rgba(0,0,0,0) 100%);
      transition: mask-image 0.05s ease-out, -webkit-mask-image 0.05s ease-out;
    }

    /* Clickable Logo */
    .logo {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80vw;  /* Responsive: 80% of viewport width */
      max-width: 1000px;  /* Prevents the logo from becoming too large */
      height: auto;
      cursor: pointer;
      z-index: 10; /* Ensures it's above videos */
    }

    /* Loader Overlay */
    .loader-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000; /* Above everything else */
    }

    .loader-logo {
      width: 60vw;
      max-width: 600px;
      height: auto;
      margin-bottom: 60px;
    }

    .loader-number {
      font-family: Arial, sans-serif;
      font-size: 80px;
      font-weight: bold;
      color: white;
      text-align: center;
    }
  </style>
</head>
<body>

  <!-- Loader Overlay -->
  <div id="loaderOverlay" class="loader-overlay">
    <img src="https://freight.cargo.site/t/original/i/R2192464133004486997848030041226/DM_Logo_for_web_V01-no-bottom-bit.png" alt="Dreamachine Logo" class="loader-logo">
    <div id="loaderNumber" class="loader-number">0</div>
  </div>

  <!-- Bottom Video -->
  <video id="bottomVideo" class="video-container" muted playsinline>
    <source src="https://freight.cargo.site/m/L2190992256300586244793696638090/AI-BLACK.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <!-- Top Video (initially covering the bottom one) -->
  <video id="topVideo" class="video-container top-video" muted playsinline>
    <source src="https://freight.cargo.site/m/A2191010521805399430148968010890/inverted-depth.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <!-- Clickable Logo -->
  <a href="mailto:hello@thedreamachine.com?subject=Portfolio%20Request&body=Hello,%20I%20would%20like%20to%20know%20more%20about...">
    <img src="https://freight.cargo.site/t/original/i/R2192464133004486997848030041226/DM_Logo_for_web_V01-no-bottom-bit.png" alt="Logo" class="logo">
  </a>

  <script>
    const topVideo = document.getElementById("topVideo");
    const bottomVideo = document.getElementById("bottomVideo");
    const loaderOverlay = document.getElementById("loaderOverlay");
    const loaderNumber = document.getElementById("loaderNumber");

    let revealRadius = 50; // Size of the fully revealed area (hard edge)
    let featherRadius = 300; // Additional soft feathered edge

    // Track loading states
    let topVideoReady = false;
    let bottomVideoReady = false;
    let loaderAnimationComplete = false;

    // Start the loader number animation
    function startLoaderAnimation() {
      const startTime = Date.now();
      const duration = 3000; // 3 seconds
      
      function updateNumber() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // Easing function for smooth animation (ease-out)
        const easedProgress = 1 - Math.pow(1 - progress, 3);
        const currentNumber = Math.floor(easedProgress * 100);
        
        loaderNumber.textContent = currentNumber;
        
        if (progress < 1) {
          requestAnimationFrame(updateNumber);
        } else {
          loaderAnimationComplete = true;
          checkReadyToStart();
        }
      }
      
      requestAnimationFrame(updateNumber);
    }

    // Check if we're ready to start videos (both videos buffered and animation complete)
    function checkReadyToStart() {
      if (topVideoReady && bottomVideoReady && loaderAnimationComplete) {
        hideLoaderAndStartVideos();
      }
    }

    // Hide loader and start videos in sync
    function hideLoaderAndStartVideos() {
      // Fade out the loader overlay
      const startTime = Date.now();
      const duration = 1000; // 1 second fade
      
      function fadeOut() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const opacity = 1 - progress;
        
        loaderOverlay.style.opacity = opacity;
        
        if (progress < 1) {
          requestAnimationFrame(fadeOut);
        } else {
          loaderOverlay.style.display = 'none';
        }
      }
      
      requestAnimationFrame(fadeOut);

      // Start videos in sync
      syncVideos();
    }

    // Ensure both videos start at the exact same time
    function syncVideos() {
      topVideo.currentTime = 0;
      bottomVideo.currentTime = 0;

      // Play both videos simultaneously
      Promise.all([topVideo.play(), bottomVideo.play()])
        .then(() => {
          console.log("Both videos started in sync");
        })
        .catch(error => {
          console.error("Error playing videos:", error);
        });
    }

    // Restart videos in sync when they end
    function restartVideos() {
      topVideo.currentTime = 0;
      bottomVideo.currentTime = 0;
      syncVideos();
    }

    // Sync playback speeds (prevents drift over time)
    function matchPlaybackRates() {
      bottomVideo.playbackRate = topVideo.playbackRate;
    }

    // Video event listeners for buffering
    topVideo.addEventListener("canplaythrough", function() {
      topVideoReady = true;
      checkReadyToStart();
    });

    bottomVideo.addEventListener("canplaythrough", function() {
      bottomVideoReady = true;
      checkReadyToStart();
    });

    // Handle video loading errors - proceed anyway after timeout
    topVideo.addEventListener("error", function() {
      topVideoReady = true; // Consider it "ready" even if failed
      checkReadyToStart();
    });

    bottomVideo.addEventListener("error", function() {
      bottomVideoReady = true; // Consider it "ready" even if failed
      checkReadyToStart();
    });

    // Fallback timeout - if videos don't load after 10 seconds, proceed anyway
    setTimeout(function() {
      topVideoReady = true;
      bottomVideoReady = true;
      checkReadyToStart();
    }, 10000);

    // Sync playback rates continuously
    topVideo.addEventListener("ratechange", matchPlaybackRates);
    bottomVideo.addEventListener("ratechange", matchPlaybackRates);

    // Ensure both videos restart together
    topVideo.addEventListener("ended", restartVideos);
    bottomVideo.addEventListener("ended", restartVideos);

    // Mouse movement effect for reveal with a hard center and feathered edges
    document.addEventListener("mousemove", (event) => {
      const mouseX = event.clientX || 0;
      const mouseY = event.clientY || 0;

      // Adjust radial gradient so the center is fully revealed with only feathered edges
      const maskStyle = `radial-gradient(circle ${revealRadius + featherRadius}px at ${mouseX}px ${mouseY}px, 
                          rgba(0,0,0,1) ${revealRadius}px, 
                          rgba(0,0,0,0) ${revealRadius + featherRadius}px)`;
      
      topVideo.style.maskImage = maskStyle;
      topVideo.style.webkitMaskImage = maskStyle;
    });

    // Start the loader animation when the page loads
    window.addEventListener('load', startLoaderAnimation);

  </script>

</body>
</html>
