<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dreamachine</title>

  <!-- Favicon Links -->
  <link rel="icon" type="image/png" href="assets/favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="assets/favicon/favicon.svg" />
  <link rel="shortcut icon" href="assets/favicon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="dreamachine" />
  <link rel="manifest" href="assets/favicon/site.webmanifest" />

  <style>
    /* Ensure fullscreen layout */
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
    }
    /* Common styles for both videos */
    .video-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    /* The top video has a circular reveal effect with feathered edges */
    .top-video {
      position: absolute;
      -webkit-mask-image: radial-gradient(circle, rgba(0,0,0,1) 50%, rgba(0,0,0,0) 100%);
      mask-image: radial-gradient(circle, rgba(0,0,0,1) 50%, rgba(0,0,0,0) 100%);
      transition: mask-image 0.05s ease-out, -webkit-mask-image 0.05s ease-out;
    }
    /* Clickable Logo with Glow Effect */
    .logo {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80vw;
      max-width: 1000px;
      height: auto;
      cursor: pointer;
      z-index: 10;
      filter: drop-shadow(0px 0px 10px rgba(255,255,255,0.8)); /* Soft glow effect */
    }
  </style>
</head>
<body>
  <!-- Bottom Video -->
  <video id="bottomVideo" class="video-container" muted playsinline preload="auto">
    <source src="https://freight.cargo.site/m/L2190992256300586244793696638090/AI-BLACK.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <!-- Top Video (initially covering the bottom one) -->
  <video id="topVideo" class="video-container top-video" muted playsinline preload="auto">
    <source src="https://freight.cargo.site/m/A2191010521805399430148968010890/inverted-depth.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <!-- Clickable Logo -->
  <a href="mailto:hello@thedreamachine.com?subject=Portfolio%20Request&body=Hello,%20I%20would%20like%20to%20know%20more%20about...">
    <img src="https://freight.cargo.site/t/original/i/Y2190973051432224593926928323722/DM_Logo_for_web_V01.png" alt="Logo" class="logo">
  </a>

  <script>
    const topVideo = document.getElementById("topVideo");
    const bottomVideo = document.getElementById("bottomVideo");

    let hasInteracted = false;

    // **Ensure videos fully load before playing**
    async function preloadVideos() {
      await Promise.all([
        new Promise(resolve => topVideo.addEventListener("canplaythrough", resolve, { once: true })),
        new Promise(resolve => bottomVideo.addEventListener("canplaythrough", resolve, { once: true }))
      ]);
      console.log("Videos preloaded.");
      if (hasInteracted) startVideos();
    }

    // **Start videos in sync**
    function startVideos() {
      topVideo.currentTime = 0;
      bottomVideo.currentTime = 0;
      Promise.all([topVideo.play(), bottomVideo.play()])
        .then(() => console.log("Both videos started in sync"))
        .catch(error => console.warn("Autoplay blocked: Waiting for user interaction."));
    }

    // **Maintain Sync without Restarting**
    function forceFrameSync() {
      if (Math.abs(topVideo.currentTime - bottomVideo.currentTime) > 0.02) {
        bottomVideo.playbackRate = topVideo.playbackRate = 1;
        bottomVideo.currentTime = topVideo.currentTime;
      }
    }

    // **Ensure Videos Keep Playing Without Restarting**
    function ensureVideosPlaying() {
      if (topVideo.paused || bottomVideo.paused) {
        console.warn("One of the videos paused, resuming...");
        topVideo.play();
        bottomVideo.play();
      }
    }

    // **Click to Play (Fixes Autoplay Block)**
    document.addEventListener("click", () => {
      if (!hasInteracted) {
        hasInteracted = true;
        startVideos();
      }
    });

    // **Fix for Mouse Hover**
    document.addEventListener("mousemove", (event) => {
      requestAnimationFrame(() => {
        const maskStyle = `radial-gradient(circle 350px at ${event.clientX}px ${event.clientY}px, rgba(0,0,0,1) 50%, rgba(0,0,0,0) 100%)`;
        topVideo.style.maskImage = maskStyle;
        topVideo.style.webkitMaskImage = maskStyle;
      });
    });

    // **Ensure Sync Without Resetting to 0**
    setInterval(forceFrameSync, 16);
    setInterval(ensureVideosPlaying, 3000);

    // **Start Preloading**
    preloadVideos();
  </script>
</body>
</html>
