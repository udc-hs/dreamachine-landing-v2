<!-- Loader overlay for dreamachine-landing-v2 (GSAP + Logo) -->
<div id="loader-overlay" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:black;z-index:1000;display:flex;flex-direction:column;justify-content:center;align-items:center;">
  <img src="https://freight.cargo.site/t/original/i/R2192464133004486997848030041226/DM_Logo_for_web_V01-no-bottom-bit.png" alt="Dreamachine logo" style="width:40vw;max-width:500px;height:auto;margin-bottom:2rem;">
  <div id="loader-number" style="font-size:6rem;color:#fff;font-weight:bold;text-shadow:2px 2px 8px #000;">0</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.10.4/gsap.min.js"></script>
<script>
  // Loader logic
  let loaderCounter = { value: 0 };
  let loaderDuration = 5; // seconds

  // Animate number from 0 to 100
  gsap.to(loaderCounter, {
    value: 100,
    duration: loaderDuration,
    ease: "power2.out",
    onUpdate: () => {
      document.getElementById('loader-number').textContent = Math.round(loaderCounter.value);
    }
  });

  // Wait for both videos and loader animation
  let videosLoaded = 0;
  function tryReveal() {
    if (videosLoaded === 2 && loaderCounter.value >= 100) {
      gsap.to("#loader-overlay", {opacity:0, duration:1, onComplete:()=>{
        document.getElementById("loader-overlay").style.display = "none";
        startVideos();
      }});
    }
  }

  document.addEventListener("DOMContentLoaded", function() {
    const topVideo = document.getElementById("topVideo");
    const bottomVideo = document.getElementById("bottomVideo");
    if (topVideo && bottomVideo) {
      topVideo.addEventListener("canplaythrough", function() {
        videosLoaded++;
        tryReveal();
      });
      bottomVideo.addEventListener("canplaythrough", function() {
        videosLoaded++;
        tryReveal();
      });
    }
    gsap.delayedCall(loaderDuration, tryReveal);
  });

  function startVideos() {
    const topVideo = document.getElementById("topVideo");
    const bottomVideo = document.getElementById("bottomVideo");
    if (topVideo && bottomVideo) {
      topVideo.currentTime = 0;
      bottomVideo.currentTime = 0;
      Promise.all([topVideo.play(), bottomVideo.play()])
        .then(()=>{
          topVideo.classList.add("loaded");
          bottomVideo.classList.add("loaded");
        });
    }
  }
</script>